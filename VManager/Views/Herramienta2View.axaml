<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="VManager.Views.Herramienta2View"
             x:DataType="vm:Herramienta2ViewModel"
             xmlns:vm="using:VManager.ViewModels"
             xmlns:behaviors="clr-namespace:VManager.Behaviors"
             xmlns:services="clr-namespace:VManager.Services">

    <UserControl.Resources>
        <services:ValidPathConverter x:Key="ValidPathConverter" />
    </UserControl.Resources>
    
  <Grid ClipToBounds="True">
      <Border BorderBrush="{DynamicResource BorderBrushPrimary}" 
              BorderThickness="2" 
              CornerRadius="10" 
              Padding="0" 
              Margin="0,20,20,0"
              Background="{DynamicResource PanelBackgroundBrush}"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              ClipToBounds="True"
              behaviors:DragDropHelper.EnableFileDrop="True"
              behaviors:DragDropHelper.DropTarget="VideoPath">

      <ScrollViewer Padding="0" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" AllowAutoHide="True" Background="Transparent">
        <StackPanel Margin="20" Spacing="12" HorizontalAlignment="Center" VerticalAlignment="Center">

            <!-- Título -->
            <TextBlock Text="{Binding L[VCompress.Title]}" 
                       FontSize="25" 
                       HorizontalAlignment="Center" 
                       FontWeight="Bold"/>
            
          <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center" Margin="0 0 0 35">
              <!-- 
            <Button Content="⚠️ Forzar recálculos"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    FontSize="10"
                    Command="{Binding RefreshCodecsCommand}"
                    Width="112"/>-->
            
              <Button 
                  Command="{Binding ClearInfoCommand}"
                  x:Name="ClearInfo"
                  HotKey="F5"
                  HorizontalAlignment="Center"
                  Width="105">
                  <Button.Content>
                      <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="8">
                          <!-- Aquí el PathIcon -->
                          <PathIcon Data="M5.50999526,3.31842271 C5.12151573,3.31842271 4.80046129,3.60710385 4.74965,3.9816481 L4.74264499,4.08577298 L4.74264499,6.97963208 C4.74264499,7.36811161 5.03132614,7.68916605 5.40587038,7.73997735 L5.50999526,7.74698235 L8.40385436,7.74698235 C8.82765021,7.74698235 9.17120463,7.40342793 9.17120463,6.97963208 C9.17120463,6.59115255 8.88252349,6.27009811 8.50797925,6.21928681 L8.40385436,6.21228181 L7.42512053,6.21182461 C10.3377833,3.87107476 14.6073963,4.05209336 17.3101833,6.75488039 C20.2069829,9.65167996 20.2069829,14.34832 17.3101833,17.2451196 C14.4133838,20.1419192 9.71674369,20.1419192 6.81994412,17.2451196 C5.05698183,15.4821573 4.31886614,12.9925923 4.78189684,10.58925 C4.86207142,10.173107 4.58971523,9.77076216 4.17357228,9.69058758 C3.75742932,9.610413 3.35508446,9.88276918 3.27490988,10.2989121 C2.71652434,13.1971899 3.60781134,16.2033812 5.73474696,18.3303168 C9.23088437,21.8264542 14.8992431,21.8264542 18.3953805,18.3303168 C21.8915179,14.8341794 21.8915179,9.16582064 18.3953805,5.66968323 C15.0747703,2.34907304 9.7945807,2.18235834 6.27720505,5.16953912 L6.27734554,4.08577298 C6.27734554,3.66197713 5.93379112,3.31842271 5.50999526,3.31842271 Z" 
                                    Width="15" Height="15" />
                          <!-- Texto del botón enlazado -->
                          <TextBlock Text="{Binding L[VCompress.Buttons.Refresh]}" VerticalAlignment="Center"/>
                      </StackPanel>
                  </Button.Content>
            
              </Button>

                    
          </StackPanel>

          <!-- Selección de archivo -->
            <StackPanel Spacing="6" HorizontalAlignment="Stretch">
          <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Center">
            <TextBlock Text="{Binding L[VCompress.Fields.SelectVideo]}" 
                       FontSize="14" 
                       VerticalAlignment="Center"/>
        
            <Button Command="{Binding BrowseCommand}" 
                    HotKey="B" 
                    Width="100"
                    HorizontalAlignment="Center">
              <Button.Content>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="6">
                  <!-- Ícono a la izquierda -->
                  <PathIcon Data="M11.5,2.75 C16.3324916,2.75 20.25,6.66750844 20.25,11.5 C20.25,13.6461673 19.4773285,15.6118676 18.1949905,17.1340957 L25.0303301,23.9696699 C25.3232233,24.2625631 25.3232233,24.7374369 25.0303301,25.0303301 C24.7640635,25.2965966 24.3473998,25.3208027 24.0537883,25.1029482 L23.9696699,25.0303301 L17.1340957,18.1949905 C15.6118676,19.4773285 13.6461673,20.25 11.5,20.25 C6.66750844,20.25 2.75,16.3324916 2.75,11.5 C2.75,6.66750844 6.66750844,2.75 11.5,2.75 Z M11.5,4.25 C7.49593556,4.25 4.25,7.49593556 4.25,11.5 C4.25,15.5040644 7.49593556,18.75 11.5,18.75 C15.5040644,18.75 18.75,15.5040644 18.75,11.5 C18.75,7.49593556 15.5040644,4.25 11.5,4.25 Z"
                            Width="16"
                            Height="16"
                            VerticalAlignment="Center"/>
                  <!-- Texto enlazado -->
                  <TextBlock Text="{Binding L[VCompress.Buttons.Browse]}" 
                             VerticalAlignment="Center"/>
                </StackPanel>
              </Button.Content>
            </Button>
          </StackPanel>

          <Border Padding="2">
            <TextBox Text="{Binding VideoPath}" 
                     IsReadOnly="True"
                     Watermark="{Binding L[VCompress.Fields.VideoPath]}"
                     HorizontalAlignment="Stretch"/>
          </Border>
        </StackPanel>

          <!-- Porcentaje de compresión -->
          <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,15,0,0" HorizontalAlignment="Center">
            <TextBlock Text="{Binding L[VCompress.Fields.Quality]}" FontSize="14" VerticalAlignment="Center"/>
            <TextBox Text="{Binding PorcentajeCompresionUsuario}" Width="30"/>
            <TextBlock Text="%" FontSize="14" VerticalAlignment="Center"/>
          </StackPanel>

          <!-- ............. CANVA DINÁMICO ............. -->    
            <Canvas x:Name="MyCanvas" Background="Transparent">

                <!-- Bloque Video -->
                <Canvas x:Name="VideoBlockCanvas" Width="150" Height="70">
                    <Canvas.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Canvas.Left" Duration="0:0:0.2" Easing="CubicEaseOut"/>
                            <DoubleTransition Property="Canvas.Top" Duration="0:0:0.2" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Canvas.Transitions>
                    
                    <TextBlock Text="{Binding L[VCompress.Fields.VideoCodec]}" HorizontalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" Spacing="6" Margin="0 25 0 0">
                        <Button x:Name="QuestionMark6" Content="?" Width="30" FontWeight="Bold">
                            <ToolTip.Tip>
                                <TextBlock MaxWidth="400" TextWrapping="Wrap">
                                    <Run Text="La opción predeterminada es la mejor para la mayoría de los casos."/>
                                    <LineBreak/><LineBreak/>
                                    <Run Text="Se prioriza la aceleración por hardware (que se utilice tu GPU)."/>
                                    <LineBreak/><LineBreak/>
                                    <Run Text="Un códec de video básicamente comprime y descomprime video para ahorrar espacio o transmitir más rápido."/>
                                    <LineBreak/><LineBreak/>
                                    <Run Text="Si prefieres usar la CPU en lugar de la GPU, usa codecs como 'libx264'."/>
                                    <LineBreak/>
                                    <Run Text="La ventaja de usar la CPU es que provee la mejor calidad. La desventaja es que es mucho más lento."/>
                                </TextBlock>
                            </ToolTip.Tip>
                        </Button>
                        <ComboBox ItemsSource="{Binding AvailableVideoCodecs}" 
                                  SelectedItem="{Binding SelectedVideoCodec, Mode=TwoWay}"
                                  Width="200"/>
                    </StackPanel>
                    
                    
                </Canvas>

                <!-- Bloque Audio -->
                <Canvas x:Name="AudioBlockCanvas" Width="150" Height="70">
                    <Canvas.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Canvas.Left" Duration="0:0:0.2" Easing="CubicEaseOut"/>
                            <DoubleTransition Property="Canvas.Top" Duration="0:0:0.2" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Canvas.Transitions>
                    
                    <TextBlock Text="{Binding L[VCompress.Fields.AudioCodec]}" HorizontalAlignment="Center"/>
                    <StackPanel Orientation="Horizontal" Spacing="6" Margin="0 25 0 0">
                            <Button x:Name="QuestionMark7" Content="?" Width="30" FontWeight="Bold">
                                <ToolTip.Tip>
                                    <TextBlock MaxWidth="400" TextWrapping="Wrap">
                                        <Run Text="La opción predeterminada es la mejor para la mayoría de los casos."/>
                                        <LineBreak/><LineBreak/>
                                        <Run Text="Un códec de audio básicamente comprime y descomprime audio para ahorrar espacio o transmitir más rápido."/>
                                        <LineBreak/><LineBreak/>
                                        <Run Text="FLAC permite una calidad de audio excepcional, con la desventaja de consumir mucho espacio de almacenamiento."/>
                                    </TextBlock>
                                </ToolTip.Tip>
                            </Button>
                            <ComboBox ItemsSource="{Binding AvailableAudioCodecs}" 
                                      SelectedItem="{Binding SelectedAudioCodec, Mode=TwoWay}"
                                      Width="200"/> 
                        </StackPanel>
                </Canvas>

                <!-- Barra de progreso   511 -->
                <Canvas x:Name="BarraProgreso" Tag="movible" Canvas.Top="-35">
                    <Canvas.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Canvas.Left" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                            <DoubleTransition Property="Canvas.Top" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Canvas.Transitions>

                    <Grid Margin="0,150,0,0" Width="{Binding GridWidth}" HorizontalAlignment="Center">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <ProgressBar Grid.Column="0" Minimum="0" Maximum="100" Foreground="{DynamicResource AccentBrush}"
                                     Value="{Binding Progress}" Height="20"/>
                        <TextBlock Grid.Column="1" Text="{Binding Progress, StringFormat={}{0}%}"
                                   VerticalAlignment="Center" Margin="8,0,0,0"/>
                    </Grid>
                </Canvas>    
                
                <!-- Estado -->
                <Canvas x:Name="Estado" Width="150" Height="70" Tag="movible" Canvas.Top="140">
                    <Canvas.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Canvas.Left" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                            <DoubleTransition Property="Canvas.Top" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Canvas.Transitions>

                    <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="{Binding Status}" FontSize="12" Margin="0,2,0,0" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding OutputPath}" FontSize="12" Margin="0,7,0,0" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding Warning}" FontSize="12" Margin="0,8,0,0" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Canvas> 
                
                <!-- Botón Comprimir -->
                <Canvas x:Name="Comprimir" Width="150" Height="70" Tag="movible" Canvas.Top="175">
                    <Canvas.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Canvas.Left" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                            <DoubleTransition Property="Canvas.Top" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Canvas.Transitions>

                    <Button Content="{Binding L[VCompress.Buttons.Compress]}" 
                            Classes="Accented"
                            IsEnabled="{Binding VideoPath, Converter={StaticResource ValidPathConverter}}"
                            FontSize="18"
                            FontWeight="DemiBold"
                            Command="{Binding CompressCommand}" 
                            Width="165"
                            HotKey="Enter"
                            Margin="48,15,0,0" 
                            HorizontalAlignment="Center"/>
                </Canvas> 
                
                <!-- Botón de Cancelar -->
                <Canvas x:Name="Cancelar" Width="145" Height="70" HorizontalAlignment="Center" Tag="movible" Canvas.Top="230">
                    <Canvas.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Canvas.Left" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                            <DoubleTransition Property="Canvas.Top" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Canvas.Transitions>
                    <Button Content="{Binding L[VCompress.Buttons.Cancel]}"
                            IsEnabled="{Binding IsConverting}"
                            FontSize="12"
                            Command="{Binding ShowCancelDialogCommand}"
                            Classes="RedAccented"
                            HotKey="Escape"
                            HorizontalAlignment="Center"
                            Width="90"/>
                </Canvas>

                <!-- Mostrar archivo -->
                <Canvas x:Name="MostrarArchivo" Width="150" Height="70" Tag="movible" Canvas.Top="250">
                    <Canvas.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Canvas.Left" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                            <DoubleTransition Property="Canvas.Top" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                        </Transitions>
                    </Canvas.Transitions>

                    <ToggleButton Content="Mostrar archivo en carpeta"
                                  IsVisible="{Binding IsFileReadyVisible}"
                                  IsChecked="{Binding IsClicked, Mode=TwoWay}"
                                  Command="{Binding ShowFileInFolderCommand}"
                                  HorizontalAlignment="Center"
                                  Margin="0,20,0,0">
                        <ToggleButton.Styles>
                            
                            <!-- Hover -->
                            <Style Selector="ToggleButton:pointerover /template/ ContentPresenter#PART_ContentPresenter">
                                <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
                                <Setter Property="Foreground" Value="{DynamicResource AccentForegroundBrush}" />
                            </Style>

                            <!-- Pressed -->
                            <Style Selector="ToggleButton:pressed /template/ ContentPresenter#PART_ContentPresenter">
                                <Setter Property="Background" Value="{DynamicResource AccentForegroundBrush}" />
                                <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
                            </Style>

                            <!-- Checked (persiste después del clic) -->
                            <Style Selector="ToggleButton:checked /template/ ContentPresenter#PART_ContentPresenter">
                                <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
                                <Setter Property="Foreground" Value="{DynamicResource AccentForegroundBrush}" />
                            </Style>
                        </ToggleButton.Styles>
                    </ToggleButton>
                </Canvas>   

            </Canvas>
            <!-- ............. CIERRA CANVA DINÁMICO ............. -->
          <!-- Codecs Video + Audio -->
          <StackPanel Orientation="Horizontal" Spacing="40" HorizontalAlignment="Center" Margin="0,0,0,0">

              <!-- Video -->
              <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Width="230" Height="{Binding HeightBlock}"></TextBlock>
              </StackPanel>

              <!-- Audio -->
              <StackPanel Orientation="Horizontal" Spacing="6">
                  <TextBlock Width="230"></TextBlock>
              </StackPanel>
          
          </StackPanel>
        
        </StackPanel>
      </ScrollViewer>
    </Border>
    
  </Grid>
</UserControl>