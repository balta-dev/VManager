<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="VManager.Views.ConfigurationView"
             x:DataType="vm:ConfigurationViewModel"
             xmlns:vm="using:VManager.ViewModels"
             xmlns:cc="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls.ColorPicker"
             xmlns:services="clr-namespace:VManager.Services"
             xmlns:behaviors="clr-namespace:VManager.Behaviors">

  <UserControl.Resources>
    <services:ValidPathConverter x:Key="ValidPathConverter" />
  </UserControl.Resources>

  <Grid>
    <Border BorderBrush="{DynamicResource BorderBrushPrimary}"
            BorderThickness="2"
            CornerRadius="10"
            Padding="0"
            Margin="0,20,20,0"
            Background="{DynamicResource PanelBackgroundBrush}"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch"
            ClipToBounds="True"
            behaviors:DragDropHelper.EnableFileDrop="True"
            behaviors:DragDropHelper.DropTarget="CookiesFilePath"
            behaviors:DragDropHelper.AllowTxt="True">

      <ScrollViewer Padding="0"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled"
                    AllowAutoHide="True"
                    Background="Transparent">
        
        <StackPanel Margin="20"
                    Spacing="20"
                    HorizontalAlignment="Stretch">

          <!--  Selector de idioma -->
          <StackPanel Orientation="Horizontal"
                      Spacing="8"
                      HorizontalAlignment="Center">
            <TextBlock Text="Idioma / Language:"
                       FontSize="15"
                       FontWeight="DemiBold"
                       VerticalAlignment="Center"/>
            <ComboBox ItemsSource="{Binding Idiomas}"
                      SelectedItem="{Binding IdiomaSeleccionado, Mode=TwoWay}"
                      Width="170"/>
          </StackPanel>

          <!-- T铆tulo -->
          <StackPanel Spacing="5" HorizontalAlignment="Center">
            <TextBlock Text="{Binding L[Configuration.Title]}"
                       FontSize="25"
                       FontWeight="Bold"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{Binding OpenConfig}"
                       FontSize="12"
                       Classes="RedAccented"
                       HorizontalAlignment="Center"/>
          </StackPanel>

          <!-- Apariencia -->
          <Expander IsExpanded="True"
                    HorizontalAlignment="Stretch">
            
            <Expander.Header>
              <StackPanel Orientation="Horizontal" Spacing="4">
                <!-- Aqu铆 va el PathIcon -->
                <PathIcon Width="16" Height="16"
                      Data="M5.75024 2C5.33603 2 5.00024 2.33579 5.00024 2.75V14.2505C5.00024 15.4932 6.0076 16.5005 7.25024 16.5005H9.5V19.5C9.5 20.8807 10.6193 22 12 22C13.3807 22 14.5 20.8807 14.5 19.5V16.5005H16.7502C17.9929 16.5005 19.0002 15.4932 19.0002 14.2505V2.75C19.0002 2.33579 18.6645 2 18.2502 2H5.75024ZM6.50024 11.0003V3.5H12.5V5.25154C12.5 5.66576 12.8358 6.00154 13.25 6.00154C13.6642 6.00154 14 5.66576 14 5.25154V3.5H15V6.25112C15 6.66534 15.3358 7.00112 15.75 7.00112C16.1642 7.00112 16.5 6.66534 16.5 6.25112V3.5H17.5002V11.0003H6.50024ZM6.50024 14.2505V12.5003H17.5002V14.2505C17.5002 14.6647 17.1645 15.0005 16.7502 15.0005H13.75C13.3358 15.0005 13 15.3363 13 15.7505V19.5C13 20.0523 12.5523 20.5 12 20.5C11.4477 20.5 11 20.0523 11 19.5V15.7505C11 15.3363 10.6642 15.0005 10.25 15.0005H7.25024C6.83603 15.0005 6.50024 14.6647 6.50024 14.2505Z" />
                <!-- Texto al lado -->
                <TextBlock Text="{Binding L[Configuration.Fields.Appearance]}" VerticalAlignment="Center"/>
              </StackPanel>
            </Expander.Header>
            
            <Expander.Styles>
              <Style Selector="ToggleButton#ExpanderHeader"> <Setter Property="Background" Value="{DynamicResource WindowBackgroundBrush}"/> </Style>
              <Style Selector="ToggleButton#ExpanderHeader /template/ Border#ToggleButtonBackground:pointerover">
                <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
              </Style>
            </Expander.Styles>
            
            <Border Padding="0" >
              <StackPanel Spacing="10">
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <TextBlock Text="{Binding L[Configuration.Fields.ShowProfileIcon]}"
                             FontSize="14"
                             VerticalAlignment="Center"/>
                  <CheckBox IsChecked="{Binding UseCustomIcon, Mode=TwoWay}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <TextBlock Text="Color de acento:"
                             FontSize="14"
                             VerticalAlignment="Center"/>
                  <cc:ColorPicker Color="{Binding SelectedColor}" Width="250" Height="20" />
                  <Button Content="X" Width="24" Height="24" 
                          Command="{Binding ResetAccentColorCommand}" 
                          ToolTip.Tip="Resetear color de acento"/>
                </StackPanel>
                
              <StackPanel Spacing="8" Margin="0,10,0,0">
                <TextBlock Text="Imagen de perfil:"
                           FontSize="14"
                           FontWeight="DemiBold"
                           VerticalAlignment="Center"/>
                
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <!-- Previsualizaci贸n de la imagen -->
                  <Border Width="80" Height="80"
                          CornerRadius="40"
                          ClipToBounds="True"
                          BorderBrush="{DynamicResource AccentBrush}"
                          BorderThickness="2">
                    <Border.IsVisible>
                      <Binding Path="HasProfileImage" />
                    </Border.IsVisible>
                    <Image Source="{Binding ProfileImageBitmap}"
                           Stretch="UniformToFill" />
                  </Border>
                  
                  <!-- Placeholder cuando no hay imagen -->
                  <Border Width="80" Height="80"
                          CornerRadius="40"
                          Background="{DynamicResource AccentBrush}"
                          BorderBrush="{DynamicResource BorderBrushPrimary}"
                          BorderThickness="2">
                    <Border.IsVisible>
                      <Binding Path="!HasProfileImage" />
                    </Border.IsVisible>
                    <PathIcon Width="40" Height="40"
                              Foreground="White"
                              Data="M12 2C6.477 2 2 6.477 2 12C2 17.523 6.477 22 12 22C17.523 22 22 17.523 22 12C22 6.477 17.523 2 12 2ZM12 5C13.66 5 15 6.34 15 8C15 9.66 13.66 11 12 11C10.34 11 9 9.66 9 8C9 6.34 10.34 5 12 5ZM12 19.2C9.5 19.2 7.29 17.92 6 15.98C6.03 13.99 10 12.9 12 12.9C13.99 12.9 17.97 13.99 18 15.98C16.71 17.92 14.5 19.2 12 19.2Z" />
                  </Border>
                  
                  <StackPanel Spacing="5" VerticalAlignment="Center">
                    <Button Content="Cargar imagen"
                            Command="{Binding BrowseProfileImageCommand}"
                            Width="150"
                            FontSize="13"/>
                    
                    <Button Content="Eliminar imagen"
                            Command="{Binding RemoveProfileImageCommand}"
                            Width="150"
                            FontSize="13"
                            Classes="RedAccented">
                      <Button.IsEnabled>
                        <Binding Path="HasProfileImage" />
                      </Button.IsEnabled>
                    </Button>
                    
                    <TextBlock Text="JPG, PNG, GIF, BMP, TIFF, WebP"
                               FontSize="10"
                               Opacity="0.7"
                               MaxWidth="150"
                               TextWrapping="Wrap"/>
                  </StackPanel>
                </StackPanel>
              </StackPanel>  
                
              </StackPanel>
            </Border>
          </Expander>

          <!-- Comportamiento -->
          <Expander IsExpanded="True"
                    HorizontalAlignment="Stretch">
            
            <Expander.Header>
              <StackPanel Orientation="Horizontal" Spacing="4">
                <!-- Aqu铆 va el PathIcon -->
                <PathIcon Width="16" Height="16"
                          Data="M17.9346 3.00514L17.7502 3H6.24902L6.0646 3.00514C4.35547 3.10075 2.99902 4.51697 2.99902 6.25V17.75L3.00416 17.9344C3.09977 19.6435 4.51599 21 6.24902 21H12.0215C11.7249 20.5368 11.4855 20.0335 11.3131 19.5H6.24902L6.10549 19.4942C5.20613 19.4212 4.49902 18.6682 4.49902 17.75L4.50022 8H19.499L19.4994 11.3134C20.0332 11.4858 20.5368 11.7254 21.0002 12.0222V6.25L20.9951 6.06558C20.9029 4.4175 19.5827 3.09734 17.9346 3.00514ZM6.25 4.5H17.75C18.7165 4.5 19.5 5.2835 19.5 6.25V6.5H4.5V6.25C4.5 5.2835 5.2835 4.5 6.25 4.5Z M10.9922 10.1482C10.9425 9.78215 10.6287 9.5 10.249 9.5H6.74902L6.64725 9.50685C6.28118 9.55651 5.99902 9.8703 5.99902 10.25V17.25L6.00587 17.3518C6.05553 17.7178 6.36933 18 6.74902 18H10.249L10.3508 17.9932C10.7169 17.9435 10.999 17.6297 10.999 17.25V10.25L10.9922 10.1482ZM7.49902 11H9.49902V16.5H7.49902V11Z M17.249 9.5C17.6632 9.5 17.999 9.83579 17.999 10.25C17.999 10.6297 17.7169 10.9435 17.3508 10.9932L17.249 11H12.7534C12.3392 11 12.0034 10.6642 12.0034 10.25C12.0034 9.8703 12.2856 9.55651 12.6517 9.50685L12.7534 9.5H17.249Z M12.947 16.0588L12.4998 15.6285C12.7003 15.055 12.9904 14.5258 13.3526 14.0591L13.9545 14.2369C15.0519 14.5612 16.1972 13.9002 16.4655 12.7878L16.6381 12.0719C16.9185 12.0246 17.2063 12 17.4996 12C17.7929 12 18.0806 12.0246 18.361 12.0719L18.5337 12.7878C18.802 13.9002 19.9472 14.5612 21.0446 14.2369L21.6466 14.0591C22.0087 14.5258 22.2988 15.055 22.4994 15.6285L22.0522 16.0588C21.2344 16.8456 21.2344 18.1544 22.0522 18.9412L22.4994 19.3715C22.2988 19.945 22.0087 20.4742 21.6466 20.9409L21.0446 20.7631C19.9472 20.4388 18.802 21.0998 18.5337 22.2122L18.361 22.9281C18.0806 22.9754 17.7929 23 17.4996 23C17.2063 23 16.9185 22.9754 16.6381 22.9281L16.4655 22.2122C16.1972 21.0998 15.0519 20.4388 13.9545 20.7631L13.3526 20.9409C12.9904 20.4742 12.7003 19.945 12.4998 19.3715L12.947 18.9412C13.7647 18.1544 13.7647 16.8456 12.947 16.0588ZM18.9492 17.5C18.9492 16.6716 18.3002 16 17.4996 16C16.6989 16 16.0499 16.6716 16.0499 17.5C16.0499 18.3284 16.6989 19 17.4996 19C18.3002 19 18.9492 18.3284 18.9492 17.5Z" />
                <!-- Texto al lado -->
                <TextBlock Text="{Binding L[Configuration.Fields.Behaviour]}" VerticalAlignment="Center"/>
              </StackPanel>
            </Expander.Header>
            
            <Expander.Styles>
              <Style Selector="ToggleButton#ExpanderHeader"> <Setter Property="Background" Value="{DynamicResource WindowBackgroundBrush}"/> </Style>
              <Style Selector="ToggleButton#ExpanderHeader /template/ Border#ToggleButtonBackground:pointerover">
                <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
              </Style>
            </Expander.Styles>
            <Border Padding="0">
              
              <StackPanel Spacing="10">

                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <TextBlock Text="{Binding L[Configuration.Fields.HideRemainingTime]}"
                             FontSize="14"
                             VerticalAlignment="Center"/>
                  <CheckBox IsChecked="{Binding HideRemainingTime}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <TextBlock Text="{Binding L[Configuration.Fields.HideNotifications]}"
                             FontSize="14"
                             VerticalAlignment="Center"/>
                  <CheckBox IsChecked="{Binding !EnableNotifications, Mode=TwoWay}" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <TextBlock Text="{Binding L[Configuration.Fields.EnableSounds]}"
                             FontSize="14"
                             VerticalAlignment="Center"/>
                  <CheckBox IsChecked="{Binding !EnableSounds, Mode=TwoWay}" />
                </StackPanel>
                
                <!-- Carpeta preferida para guardar videos -->
                <StackPanel Orientation="Vertical" Spacing="8" Margin="0 8 0 0" VerticalAlignment="Center">
                  <TextBlock Text="Carpeta de descargas:"
                             FontSize="14"
                             VerticalAlignment="Center" />
                </StackPanel>
                
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <TextBox Text="{Binding PreferredDownloadFolder, Mode=TwoWay}"
                         Width="260"
                         HorizontalAlignment="Left"
                         IsReadOnly="True"
                         Watermark="Escritorio (default)"/>
                
                <Button Content="Buscar..."
                        Command="{Binding BrowseDownloadFolderCommand}"
                        Width="90"/>
                </StackPanel>
                
                <!-- Archivo de cookies para yt-dlp -->
                <StackPanel Spacing="8" Margin="0,10,0,0">

                  <TextBlock Text="Cookies de sesi贸n:"
                             FontSize="14"
                             FontWeight="DemiBold"
                             VerticalAlignment="Center"/>

                  <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">

                    <!-- Ruta del archivo -->
                    <TextBox Text="{Binding CookiesFilePath}" 
                             Width="260"
                             IsReadOnly="True"
                             Watermark="Ning煤n archivo seleccionado"/>

                    <!-- Bot贸n seleccionar cookies -->
                    <Button Content="Buscar..."
                            Width="90"
                            Command="{Binding BrowseCookiesFileCommand}"/>
                  </StackPanel>

                  <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">

                    <!-- Checkbox: activar uso del archivo -->
                    <CheckBox IsChecked="{Binding UseCookiesFile, Mode=TwoWay}" />

                    <TextBlock Text="Usar este archivo de cookies para yt-dlp"
                               FontSize="13"
                               VerticalAlignment="Center"/>
                  </StackPanel>

                  <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <!-- Fecha de actualizaci贸n -->
                    <!--<TextBlock Text="{Binding CookiesLastUpdated, StringFormat='ltima actualizaci贸n: {0:dd/MM/yyyy HH:mm}'}"
                               FontSize="11"
                               Opacity="0.7">
                      <TextBlock IsVisible="{Binding CookiesLastUpdated, Converter={StaticResource ValidPathConverter}}"/>
                    </TextBlock>-->

                    <!-- Bot贸n limpiar cookies -->
                    <Button Content="Eliminar"
                            Width="90"
                            Classes="RedAccented"
                            Command="{Binding RemoveCookiesFileCommand}">
                      <Button.IsEnabled>
                        <Binding Path="CookiesFilePath" Converter="{StaticResource ValidPathConverter}" />
                      </Button.IsEnabled>
                    </Button>
                  </StackPanel>

                </StackPanel>

              </StackPanel>
            </Border>
          </Expander>

          <!-- Avanzado -->
          <Expander IsExpanded="True"
                    HorizontalAlignment="Stretch">
            
            <Expander.Header>
              <StackPanel Orientation="Horizontal" Spacing="4">
                <!-- Aqu铆 va el PathIcon -->
                <PathIcon Width="16" Height="16"
                          Data="M2 5.25C2 3.45507 3.45507 2 5.25 2H16.75C18.5449 2 20 3.45507 20 5.25V8.00934C19.4951 7.95675 18.9878 7.99076 18.5 8.10566V7H3.5V16.75C3.5 17.7165 4.2835 18.5 5.25 18.5H13.2347L12.7935 19.2641C12.6577 19.4994 12.5652 19.7477 12.5135 20H5.25C3.45507 20 2 18.5449 2 16.75V5.25ZM5.25 3.5C4.2835 3.5 3.5 4.2835 3.5 5.25V5.5H18.5V5.25C18.5 4.2835 17.7165 3.5 16.75 3.5H5.25Z M19.8565 9C19.6411 8.98005 19.4255 8.9803 19.2123 9C18.1194 9.10098 17.0907 9.71296 16.5002 10.7357C15.7915 11.9632 15.9109 13.4415 16.685 14.5239L13.6595 19.7641C13.6153 19.8407 13.5788 19.9196 13.5499 20C13.3149 20.6516 13.5724 21.3977 14.1933 21.7562C14.8908 22.1589 15.7828 21.9199 16.1855 21.2224L19.2166 15.9724C20.5321 16.0903 21.8586 15.4548 22.5624 14.2357C23.3244 12.916 23.1291 11.3063 22.1921 10.2105L20.5417 13.0691C20.2195 13.6271 19.506 13.8183 18.948 13.4961C18.39 13.1739 18.1988 12.4604 18.521 11.9024L20.1714 9.04377C20.0667 9.0243 19.9616 9.00974 19.8565 9Z M15.1652 13.5745C14.9952 12.8933 14.9834 12.1718 15.1463 11.4698L12.8579 9.17831C12.6628 8.98291 12.3462 8.98269 12.1508 9.17782C11.9554 9.37295 11.9552 9.68953 12.1503 9.88493L14.7934 12.5316L12.1503 15.1783C11.9552 15.3737 11.9554 15.6903 12.1508 15.8854C12.3462 16.0805 12.6628 16.0803 12.8579 15.8849L15.1652 13.5745Z M9.85672 9.88537C10.0521 9.69021 10.0523 9.37363 9.85711 9.17826C9.66196 8.98289 9.34538 8.98271 9.15001 9.17787L6.14664 12.1779C6.05275 12.2717 6 12.3989 6 12.5316C6 12.6643 6.05276 12.7916 6.14665 12.8854L9.15001 15.8854C9.34538 16.0805 9.66196 16.0803 9.85711 15.885C10.0523 15.6896 10.0521 15.373 9.85672 15.1779L7.2075 12.5316L9.85672 9.88537Z" />
                <!-- Texto al lado -->
                <TextBlock Text="{Binding L[Configuration.Fields.Advanced]}" VerticalAlignment="Center"/>
              </StackPanel>
            </Expander.Header>
            
            <Expander.Styles>
              <Style Selector="ToggleButton#ExpanderHeader"> <Setter Property="Background" Value="{DynamicResource WindowBackgroundBrush}"/> </Style>
              <Style Selector="ToggleButton#ExpanderHeader /template/ Border#ToggleButtonBackground:pointerover">
                <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
              </Style>
            </Expander.Styles>
            <Border Padding="0">
              <StackPanel Spacing="10">

                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <TextBlock Text="{Binding L[Configuration.Fields.EnableDebug]}"
                             FontSize="15"
                             VerticalAlignment="Center"/>
                  <CheckBox IsChecked="True" IsEnabled="False" />
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                  <Button Content="{Binding L[Configuration.Fields.Hardware]}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Classes="RedAccented"
                          FontSize="14"
                          Command="{Binding RefreshCodecsCommand}"
                          Width="180"/>
                  <Button Content="?" Width="30" FontWeight="Bold">
                    <ToolTip.Tip>
                      <TextBlock MaxWidth="400" TextWrapping="Wrap">
                        <Run Text="Este bot贸n inicia m煤ltiples instancias de FFMpeg en paralelo para comprobar"/>
                        <Run Text="la compatibilidad de m煤ltiples c贸decs de video para luego guardarlo en una lista desplegable."/>
                        <LineBreak/><LineBreak/>
                        <Run Text="No es recomendable tocar este bot贸n a no ser que sepa lo que est谩 haciendo..."/>
                        <Run Text="Puede ser 煤til si cambia de GPU o se gener贸 alg煤n problema, pero sepa que estresa su computadora."/>
                      </TextBlock>
                    </ToolTip.Tip>
                  </Button>
                </StackPanel>

              </StackPanel>
            </Border>
          </Expander>

        </StackPanel>
      </ScrollViewer>
    </Border>
  </Grid>
</UserControl>
